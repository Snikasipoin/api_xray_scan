<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Анализ снимка</title>
</head>
<body>
    <h2>Загрузка снимка</h2>
    <form id="upload-form" enctype="multipart/form-data">
        <input type="file" name="file" accept="image/*" required>
        <button type="submit">Загрузить</button>
    </form>

    <div id="result" style="margin-top: 20px;">
        <h3>Изображение:</h3>
        <img id="image" style="max-width: 300px;"><br>
        <h3>Тепловая карта:</h3>
        <img id="heatmap" style="max-width: 300px;"><br>

        <h3>Ключевые находки:</h3>
        <ul id="details"></ul>

        <h3>Детальный анализ:</h3>
        <p><strong>Легочная ткань:</strong> <span id="lungs"></span></p>
        <p><strong>Сердце и сосуды:</strong> <span id="heart"></span></p>
        <p><strong>Сравнительный анализ:</strong> <span id="comparison"></span></p>

        <h3>Медицинское заключение:</h3>
        <p id="conclusion"></p>
    </div>

    <script>
        document.getElementById("upload-form").onsubmit = async function(e) {
            e.preventDefault();
            const form = new FormData(this);
            const response = await fetch("/upload", { method: "POST", body: form });
            const data = await response.json();

            if (data.error) return alert(data.error);

            document.getElementById("image").src = data.image_url;
            document.getElementById("heatmap").src = data.heatmap_url;

            const list = document.getElementById("details");
            list.innerHTML = "";
            data.details.forEach(d => {
                const li = document.createElement("li");
                li.innerText = `${d.label}: ${d.confidence}`;
                list.appendChild(li);
            });

            document.getElementById("lungs").innerText = data.detailed_analysis["Легочная ткань"];
            document.getElementById("heart").innerText = data.detailed_analysis["Сердце и сосуды"];
            document.getElementById("comparison").innerText = data.detailed_analysis["Сравнительный анализ"];
            document.getElementById("conclusion").innerText = data.full_report;
        };
    </script>
</body>
</html>
